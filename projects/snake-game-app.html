<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Snake</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body { background-color: #050505; font-family: 'Press Start 2P', cursive; touch-action: none; }
    
    /* The Game Board */
    canvas {
        background: #111;
        box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
        border: 2px solid #333;
    }

    /* D-Pad for Mobile */
    .d-btn {
        background: #222;
        border: 1px solid #444;
        color: #22c55e;
        border-radius: 8px;
        font-size: 1.5rem;
        transition: background 0.1s;
    }
    .d-btn:active { background: #333; transform: scale(0.95); }

    .glow-text { text-shadow: 0 0 10px rgba(34, 197, 94, 0.8); }
  </style>
</head>
<body class="flex flex-col items-center justify-center h-screen text-white overflow-hidden p-2">

  <div class="flex justify-between w-full max-w-[400px] mb-2 px-2">
      <div class="text-green-500">SCORE: <span id="score">0</span></div>
      <div class="text-gray-500">HI: <span id="high-score">0</span></div>
  </div>

  <div class="relative">
      <canvas id="gameCanvas" width="400" height="400" class="rounded-lg"></canvas>
      
      <div id="start-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-10">
          <h1 class="text-3xl text-green-500 glow-text mb-4">NEON SNAKE</h1>
          <p class="text-xs text-gray-400 mb-6 text-center leading-relaxed">Use Arrow Keys<br>or Buttons to Move</p>
          <button onclick="startGame()" class="px-6 py-3 bg-green-600 hover:bg-green-500 text-black font-bold rounded shadow-[0_0_15px_rgba(34,197,94,0.6)] transition-all">
              START GAME
          </button>
      </div>

      <div id="game-over-screen" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-black/90 z-20">
          <h2 class="text-red-500 text-2xl mb-2">GAME OVER</h2>
          <p class="text-sm text-gray-300 mb-6">Score: <span id="final-score">0</span></p>
          <button onclick="startGame()" class="px-6 py-2 border-2 border-green-500 text-green-500 hover:bg-green-500/20 rounded font-bold transition-all">
              TRY AGAIN
          </button>
      </div>
  </div>

  <div class="grid grid-cols-3 gap-2 mt-4 w-[180px]">
      <div></div>
      <button class="d-btn h-12" onclick="changeDirection({keyCode:38})">▲</button>
      <div></div>
      <button class="d-btn h-12" onclick="changeDirection({keyCode:37})">◀</button>
      <button class="d-btn h-12" onclick="changeDirection({keyCode:40})">▼</button>
      <button class="d-btn h-12" onclick="changeDirection({keyCode:39})">▶</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const highScoreEl = document.getElementById('high-score');
    
    // Config
    const GRID_SIZE = 20;
    const TILE_COUNT = canvas.width / GRID_SIZE;
    
    // State
    let snake = [];
    let food = { x: 15, y: 15 };
    let dx = 0;
    let dy = 0;
    let score = 0;
    let highScore = localStorage.getItem('snakeHi') || 0;
    let gameInterval;
    let isGameRunning = false;

    highScoreEl.innerText = highScore;

    function startGame() {
        // Reset State
        snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
        score = 0;
        dx = 1; // Start moving right
        dy = 0;
        isGameRunning = true;
        
        scoreEl.innerText = score;
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('game-over-screen').classList.add('hidden');
        
        // Start Loop (15 FPS)
        if(gameInterval) clearInterval(gameInterval);
        gameInterval = setInterval(gameLoop, 1000/10); 
    }

    function gameLoop() {
        if(!isGameRunning) return;
        update();
        draw();
    }

    function update() {
        // Move Head
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };

        // 1. Wall Collision
        if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) {
            gameOver();
            return;
        }

        // 2. Self Collision
        for (let part of snake) {
            if (part.x === head.x && part.y === head.y) {
                gameOver();
                return;
            }
        }

        snake.unshift(head); // Add new head

        // 3. Eat Food
        if (head.x === food.x && head.y === food.y) {
            score += 10;
            scoreEl.innerText = score;
            placeFood();
        } else {
            snake.pop(); // Remove tail if not eating
        }
    }

    function draw() {
        // Clear Screen
        ctx.fillStyle = '#111';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Food (Glowing Red)
        ctx.fillStyle = '#ef4444';
        ctx.shadowBlur = 15;
        ctx.shadowColor = "#ef4444";
        ctx.fillRect(food.x * GRID_SIZE, food.y * GRID_SIZE, GRID_SIZE - 2, GRID_SIZE - 2);
        ctx.shadowBlur = 0; // Reset shadow

        // Draw Snake (Glowing Green)
        ctx.fillStyle = '#22c55e';
        snake.forEach((part, index) => {
            // Head is slightly brighter
            if(index === 0) {
                ctx.fillStyle = '#4ade80';
                ctx.shadowBlur = 10;
                ctx.shadowColor = "#22c55e";
            } else {
                ctx.fillStyle = '#22c55e';
                ctx.shadowBlur = 0;
            }
            ctx.fillRect(part.x * GRID_SIZE, part.y * GRID_SIZE, GRID_SIZE - 2, GRID_SIZE - 2);
        });
    }

    function placeFood() {
        food = {
            x: Math.floor(Math.random() * TILE_COUNT),
            y: Math.floor(Math.random() * TILE_COUNT)
        };
        // Check if food spawned on snake
        for (let part of snake) {
            if (part.x === food.x && part.y === food.y) placeFood();
        }
    }

    function gameOver() {
        isGameRunning = false;
        clearInterval(gameInterval);
        
        if(score > highScore) {
            highScore = score;
            localStorage.setItem('snakeHi', highScore);
            highScoreEl.innerText = highScore;
        }

        document.getElementById('final-score').innerText = score;
        document.getElementById('game-over-screen').classList.remove('hidden');
    }

    // Input Handling
    document.addEventListener('keydown', changeDirection);

    function changeDirection(event) {
        const key = event.keyCode;
        // Prevent reversing direction directly
        if (key === 37 && dx === 0) { dx = -1; dy = 0; } // Left
        if (key === 38 && dy === 0) { dx = 0; dy = -1; } // Up
        if (key === 39 && dx === 0) { dx = 1; dy = 0; }  // Right
        if (key === 40 && dy === 0) { dx = 0; dy = 1; }  // Down
    }
  </script>
</body>
</html>
