<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anime Quiz Ultimate</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background-color: #0f0c29; /* Deep anime night sky */ }
    /* Subtle gradient background animation */
    .anime-bg {
        background: linear-gradient(to bottom right, #0f0c29, #302b63, #24243e);
        min-height: 100vh;
    }
    .card { 
        background: rgba(20, 20, 40, 0.85); 
        backdrop-filter: blur(10px);
        border: 1px solid rgba(100, 100, 255, 0.2);
    }
    /* Button styles for answers */
    .btn-answer {
        transition: all 0.2s ease;
        border: 2px solid rgba(99, 102, 241, 0.3); /* Indigo-400 low opacity */
    }
    .btn-answer:hover:not(:disabled) {
        background-color: rgba(99, 102, 241, 0.2);
        border-color: #818cf8; /* Indigo-400 */
        transform: translateY(-2px);
    }
    .correct-answer { background-color: #22c55e !important; border-color: #22c55e !important; color: white; }
    .wrong-answer { background-color: #ef4444 !important; border-color: #ef4444 !important; color: white; }

    /* Loading Spinner */
    .loader { border: 4px solid #ffffff20; border-top: 4px solid #a855f7; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    ::-webkit-scrollbar { width: 0px; }
  </style>
</head>
<body class="anime-bg flex items-center justify-center p-4 text-white">

  <div class="card w-full max-w-xl mx-auto rounded-2xl p-6 shadow-2xl shadow-indigo-900/30">
    
    <div class="text-center mb-6">
        <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">Anime Trivia Challenge</h1>
        <p class="text-sm text-gray-400">Powered by OpenTDB API</p>
    </div>

    <div id="loading-screen" class="flex flex-col items-center justify-center py-10">
        <div class="loader mb-4"></div>
        <p class="text-indigo-300 font-medium animate-pulse">Summoning Questions...</p>
    </div>

    <div id="quiz-area" class="hidden">
        <div class="flex justify-between text-sm font-semibold text-gray-300 mb-4">
            <p>Question <span id="current-q-num" class="text-indigo-400">1</span>/<span id="total-q-num">10</span></p>
            <p>Score: <span id="score" class="text-green-400">0</span></p>
        </div>

        <h2 id="question-text" class="text-xl font-semibold mb-6 min-h-[60px] leading-relaxed">Is this a JoJo reference?</h2>

        <div id="answers-grid" class="grid grid-cols-1 gap-3 mb-4">
            </div>
    </div>

    <div id="results-screen" class="hidden text-center py-6">
        <h2 class="text-2xl font-bold mb-2">Quiz Completed!</h2>
        <p class="text-gray-300 mb-6">Your Final Rank:</p>
        
        <div class="text-5xl font-bold text-indigo-400 mb-2" id="final-score-display">8/10</div>
        <p id="result-message" class="text-lg font-medium text-purple-300 mb-8">Otaku Level!</p>

        <button onclick="restartQuiz()" class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl font-bold text-lg shadow-lg hover:shadow-indigo-500/50 transition-all active:scale-95">
            Play Again
        </button>
    </div>

  </div>

  <script>
    // --- Configuration ---
    const API_URL = "https://opentdb.com/api.php?amount=10&category=31&type=multiple"; // Category 31 is Anime/Manga

    // --- DOM Elements ---
    const loadingScreen = document.getElementById('loading-screen');
    const quizArea = document.getElementById('quiz-area');
    const resultsScreen = document.getElementById('results-screen');
    const questionText = document.getElementById('question-text');
    const answersGrid = document.getElementById('answers-grid');
    const currentQNumSpan = document.getElementById('current-q-num');
    const scoreSpan = document.getElementById('score');
    const finalScoreDisplay = document.getElementById('final-score-display');
    const resultMessage = document.getElementById('result-message');

    // --- Game State Variables ---
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let isAnswering = false; // Prevent double clicks

    // --- Main Functions ---

    async function startQuiz() {
        loadingScreen.classList.remove('hidden');
        quizArea.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        
        score = 0;
        currentQuestionIndex = 0;
        updateHUD();

        try {
            const response = await fetch(API_URL);
            const data = await response.json();
            if(data.response_code !== 0) throw new Error("API Error");
            
            questions = data.results;
            loadNextQuestion();
            loadingScreen.classList.add('hidden');
            quizArea.classList.remove('hidden');
        } catch (error) {
            loadingScreen.innerHTML = `<p class="text-red-400">Failed to load questions. API might be busy.<br><button onclick="startQuiz()" class="underline mt-2">Try Again</button></p>`;
        }
    }

    function loadNextQuestion() {
        if (currentQuestionIndex >= questions.length) {
            showResults();
            return;
        }

        isAnswering = false;
        const currentQData = questions[currentQuestionIndex];
        // Need to decode HTML entities in the text (e.g., &quot; -> ")
        questionText.innerHTML = decodeHTML(currentQData.question);
        answersGrid.innerHTML = '';
        updateHUD();

        // Combine correct and incorrect answers into one array
        let answers = [...currentQData.incorrect_answers];
        const correctAnswer = currentQData.correct_answer;
        // Insert correct answer at a random position
        const randIndex = Math.floor(Math.random() * (answers.length + 1));
        answers.splice(randIndex, 0, correctAnswer);

        // Generate Buttons
        answers.forEach(answer => {
            const btn = document.createElement('button');
            btn.innerHTML = decodeHTML(answer);
            btn.className = 'btn-answer w-full p-4 bg-gray-800/50 rounded-xl text-left font-semibold text-gray-200';
            btn.onclick = () => handleAnswerClick(btn, answer, correctAnswer);
            answersGrid.appendChild(btn);
        });
    }

    function handleAnswerClick(selectedBtn, selectedAnswer, correctAnswer) {
        if (isAnswering) return;
        isAnswering = true;

        const buttons = answersGrid.querySelectorAll('button');
        buttons.forEach(btn => btn.disabled = true); // Disable all buttons

        if (selectedAnswer === correctAnswer) {
            score++;
            selectedBtn.classList.add('correct-answer');
        } else {
            selectedBtn.classList.add('wrong-answer');
            // Highlight the correct one so they learn
            buttons.forEach(btn => {
                if (btn.innerHTML === decodeHTML(correctAnswer)) {
                    btn.classList.add('correct-answer');
                }
            });
        }

        updateHUD();
        // Wait 1.5 seconds before next question
        setTimeout(() => {
            currentQuestionIndex++;
            loadNextQuestion();
        }, 1500);
    }

    function showResults() {
        quizArea.classList.add('hidden');
        resultsScreen.classList.remove('hidden');
        finalScoreDisplay.textContent = `${score} / ${questions.length}`;
        
        const percentage = (score / questions.length) * 100;
        if(percentage === 100) resultMessage.textContent = "True Hokage Level! üèÜ";
        else if(percentage >= 80) resultMessage.textContent = "Anbu Elite! üî•";
        else if(percentage >= 50) resultMessage.textContent = "Chunin Level. Keep training! üìö";
        else resultMessage.textContent = "Genin... Back to the academy. üç•";
    }

    // --- Helper Functions ---

    function updateHUD() {
        currentQNumSpan.textContent = currentQuestionIndex + 1;
        scoreSpan.textContent = score;
    }

    function restartQuiz() {
        startQuiz();
    }

    // Decodes HTML entities returned by the API (e.g., &amp; becomes &)
    function decodeHTML(html) {
        var txt = document.createElement("textarea");
        txt.innerHTML = html;
        return txt.value;
    }

    // Start on load
    startQuiz();
  </script>
</body>
</html>
