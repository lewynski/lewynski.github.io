<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix Operations</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #111827; }
    .card { background: #1F2937; border: 1px solid #374151; }
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 4px; }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen text-white p-2">

  <div class="card w-full max-w-2xl mx-auto rounded-2xl p-4 shadow-2xl flex flex-col gap-4">
    
    <div class="flex flex-col sm:flex-row justify-between items-center gap-3 border-b border-gray-700 pb-4">
        <div>
            <h1 class="text-xl font-bold text-indigo-400">Matrix Ops</h1>
            <p class="text-xs text-gray-400">Add, Subtract, Multiply, Divide (A·B⁻¹)</p>
        </div>
        <select id="matrix-size" onchange="generateGrids()" class="bg-gray-800 text-white border border-gray-600 rounded px-3 py-1 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
            <option value="2">2 x 2</option>
            <option value="3" selected>3 x 3</option>
            <option value="4">4 x 4</option>
            <option value="5">5 x 5</option>
        </select>
    </div>

    <div class="flex flex-col md:flex-row gap-4 justify-center items-start">
        <div class="flex-1 w-full">
            <div class="text-xs font-bold text-gray-400 mb-2 text-center">MATRIX A</div>
            <div id="grid-a" class="grid gap-1"></div>
        </div>

        <div class="flex items-center justify-center md:h-full py-2">
            <span id="op-symbol" class="text-2xl font-bold text-gray-500">?</span>
        </div>

        <div class="flex-1 w-full">
            <div class="text-xs font-bold text-gray-400 mb-2 text-center">MATRIX B</div>
            <div id="grid-b" class="grid gap-1"></div>
        </div>
    </div>

    <div class="grid grid-cols-4 gap-2 mt-2">
        <button onclick="calculate('add')" class="bg-gray-700 hover:bg-indigo-600 p-2 rounded text-lg font-bold transition shadow-md">+</button>
        <button onclick="calculate('sub')" class="bg-gray-700 hover:bg-indigo-600 p-2 rounded text-lg font-bold transition shadow-md">−</button>
        <button onclick="calculate('mul')" class="bg-gray-700 hover:bg-indigo-600 p-2 rounded text-lg font-bold transition shadow-md">×</button>
        <button onclick="calculate('div')" class="bg-gray-700 hover:bg-indigo-600 p-2 rounded text-sm font-bold transition shadow-md">A·B⁻¹</button>
    </div>

    <div id="result-box" class="hidden mt-2 bg-gray-900/50 border border-gray-700 rounded-lg p-3">
        <p class="text-xs text-indigo-300 font-bold mb-2 uppercase tracking-wide">Result Matrix</p>
        <div id="grid-result" class="grid gap-1 justify-center"></div>
    </div>
    
    <p id="error-message" class="text-red-400 text-center text-xs h-4 font-medium mt-1"></p>
    <button onclick="clearGrids()" class="text-xs text-gray-500 hover:text-white underline">Clear All</button>

  </div>

  <script>
    /* --- LOGIC ENGINE --- */
    const sizeSelect = document.getElementById('matrix-size');
    const resultBox = document.getElementById('result-box');
    const errorMsg = document.getElementById('error-message');

    function generateGrids() {
        const size = parseInt(sizeSelect.value);
        createGrid('grid-a', size);
        createGrid('grid-b', size);
        resultBox.classList.add('hidden');
        errorMsg.textContent = '';
    }

    function createGrid(id, size) {
        const container = document.getElementById(id);
        container.innerHTML = '';
        container.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
        for(let i=0; i<size*size; i++) {
            const input = document.createElement('input');
            input.type = 'number';
            input.placeholder = '0';
            input.className = 'w-full bg-gray-800 border border-gray-700 rounded p-1 text-center text-sm text-white focus:border-indigo-500 outline-none';
            container.appendChild(input);
        }
    }

    function getMatrix(id, size) {
        const inputs = document.querySelectorAll(`#${id} input`);
        let m = [];
        for(let i=0; i<size; i++) {
            let row = [];
            for(let j=0; j<size; j++) {
                const val = parseFloat(inputs[i*size + j].value);
                if(isNaN(val)) throw new Error("Fill all fields");
                row.push(val);
            }
            m.push(row);
        }
        return m;
    }

    function showResult(m, size) {
        const container = document.getElementById('grid-result');
        container.innerHTML = '';
        container.style.gridTemplateColumns = `repeat(${size}, minmax(40px, 1fr))`;
        
        m.forEach(row => {
            row.forEach(val => {
                const div = document.createElement('div');
                div.textContent = Number.isInteger(val) ? val : val.toFixed(3);
                div.className = 'bg-indigo-900/40 border border-indigo-500/30 rounded p-2 text-center text-sm text-indigo-100 font-mono';
                container.appendChild(div);
            });
        });
        resultBox.classList.remove('hidden');
    }

    function calculate(op) {
        errorMsg.textContent = '';
        const size = parseInt(sizeSelect.value);
        try {
            const A = getMatrix('grid-a', size);
            const B = getMatrix('grid-b', size);
            let res;

            document.getElementById('op-symbol').textContent = 
                op==='add' ? '+' : op==='sub' ? '−' : op==='mul' ? '×' : '÷';

            if(op === 'add') res = A.map((row, i) => row.map((val, j) => val + B[i][j]));
            if(op === 'sub') res = A.map((row, i) => row.map((val, j) => val - B[i][j]));
            if(op === 'mul') res = multiplyMatrices(A, B);
            if(op === 'div') {
                const B_inv = invertMatrix(B);
                if(!B_inv) throw new Error("Matrix B is singular (No Inverse)");
                res = multiplyMatrices(A, B_inv);
            }
            showResult(res, size);
        } catch(e) {
            errorMsg.textContent = e.message;
        }
    }

    // --- MATH ALGORITHMS ---

    function multiplyMatrices(A, B) {
        const size = A.length;
        let result = new Array(size).fill(0).map(() => new Array(size).fill(0));
        for (let r = 0; r < size; r++) {
            for (let c = 0; c < size; c++) {
                for (let i = 0; i < size; i++) {
                    result[r][c] += A[r][i] * B[i][c];
                }
            }
        }
        return result;
    }

    // Gaussian Elimination for Inverse
    function invertMatrix(M) {
        const n = M.length;
        let aug = M.map((row, i) => [...row, ...Array(n).fill(0).map((_, j) => i === j ? 1 : 0)]);

        for (let i = 0; i < n; i++) {
            let pivot = aug[i][i];
            if (Math.abs(pivot) < 1e-10) return null; 
            for (let j = 0; j < 2 * n; j++) aug[i][j] /= pivot;
            for (let k = 0; k < n; k++) {
                if (k !== i) {
                    let factor = aug[k][i];
                    for (let j = 0; j < 2 * n; j++) aug[k][j] -= factor * aug[i][j];
                }
            }
        }
        return aug.map(row => row.slice(n));
    }

    function clearGrids() { generateGrids(); }
    generateGrids(); // Init
  </script>
</body>
</html>
