<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Storytelling Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #111827; } /* Gray-900 */
    .card { background: #1F2937; border: 1px solid #374151; }
    
    /* Result Screen - Now handles both Math and Story */
    .result-screen { 
        font-family: 'Playfair Display', serif; 
        min-height: 120px; /* Slightly taller to fit story */
        transition: all 0.3s ease;
    }
    
    /* Buttons Hover Effects */
    .btn-operator:hover, .btn-story:hover:not(:disabled) { 
        transform: translateY(-1px); 
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); 
    }
    
    /* Loading Spinner */
    .spinner { 
        border: 3px solid rgba(255,255,255,0.1); 
        border-left-color: #4f46e5; 
        border-radius: 50%; 
        width: 18px; 
        height: 18px; 
        animation: spin 1s linear infinite; 
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* Scrollbar hidden for aesthetic */
    ::-webkit-scrollbar { width: 0px; background: transparent; }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen text-white p-2">

  <div class="card w-full max-w-sm mx-auto rounded-2xl p-5 shadow-2xl flex flex-col gap-3">
    
    <div>
        <h1 class="text-xl font-bold text-center text-indigo-400">Storytelling Calculator</h1>
        <p class="text-center text-gray-400 text-xs">Where numbers come to life.</p>
    </div>

    <div id="result-screen" class="result-screen bg-gray-900 rounded-lg p-4 flex flex-col items-center justify-center text-center border border-gray-700 relative">
      
      <p id="result-text" class="text-gray-300 text-2xl font-bold mb-1">0</p>
      
      <div id="story-container" class="hidden w-full border-t border-gray-800 mt-2 pt-2">
          <p id="story-text" class="text-teal-400 text-sm italic leading-relaxed"></p>
          <div id="story-loader" class="spinner mx-auto hidden mt-1"></div>
      </div>

    </div>

    <div class="grid grid-cols-2 gap-2">
      <input type="text" inputmode="numeric" id="num1" placeholder="Num 1" class="bg-gray-700 border border-gray-600 rounded-lg p-2 text-center text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
      <input type="text" inputmode="numeric" id="num2" placeholder="Num 2" class="bg-gray-700 border border-gray-600 rounded-lg p-2 text-center text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
    </div>

    <div class="grid grid-cols-4 gap-2">
      <button onclick="performCalculation('+')" class="btn-operator bg-indigo-600 p-2 rounded-lg text-lg font-bold shadow-md transition-colors hover:bg-indigo-500">+</button>
      <button onclick="performCalculation('-')" class="btn-operator bg-indigo-600 p-2 rounded-lg text-lg font-bold shadow-md transition-colors hover:bg-indigo-500">−</button>
      <button onclick="performCalculation('*')" class="btn-operator bg-indigo-600 p-2 rounded-lg text-lg font-bold shadow-md transition-colors hover:bg-indigo-500">×</button>
      <button onclick="performCalculation('/')" class="btn-operator bg-indigo-600 p-2 rounded-lg text-lg font-bold shadow-md transition-colors hover:bg-indigo-500">÷</button>
    </div>
    
    <button id="story-button" disabled onclick="showStory()" class="btn-story w-full bg-teal-600 hover:bg-teal-500 p-2 rounded-lg text-sm font-bold shadow-md disabled:opacity-50 disabled:cursor-not-allowed transition text-white">
      ✨ Tell me a Story
    </button>
    
    <p id="error-message" class="text-red-400 text-center text-xs h-3"></p>

  </div>

  <script>
    /* Javascript Logic */
    const resultText = document.getElementById('result-text');
    const errorMessage = document.getElementById('error-message');
    const storyButton = document.getElementById('story-button');
    const storyContainer = document.getElementById('story-container'); // New Container inside screen
    const storyText = document.getElementById('story-text');
    const storyLoader = document.getElementById('story-loader');
    
    let lastCalculation = null;

    function performCalculation(operator) {
      const num1Input = document.getElementById('num1');
      const num2Input = document.getElementById('num2');
      errorMessage.textContent = '';
      
      // Reset UI when new math is done
      storyButton.disabled = true; 
      storyContainer.classList.add('hidden'); // Hide old story
      storyText.textContent = '';
      
      let num1, num2;
      try {
        if (!/^-?\d+$/.test(num1Input.value) || !/^-?\d+$/.test(num2Input.value)) throw new Error();
        num1 = BigInt(num1Input.value); num2 = BigInt(num2Input.value);
      } catch (e) { errorMessage.textContent = 'Enter whole numbers.'; return; }

      let result, symbol = operator;
      if (operator === '+') result = num1 + num2;
      if (operator === '-') result = num1 - num2;
      if (operator === '*') { result = num1 * num2; symbol = '×'; }
      if (operator === '/') { if(num2===0n){errorMessage.textContent='No zero division';return;} result = num1/num2; symbol = '÷'; }

      // Display math result in large font
      resultText.innerHTML = `${num1} ${symbol} ${num2} = ${result}`;
      
      lastCalculation = { num1: num1.toString(), op: symbol, num2: num2.toString(), res: result.toString() };
      storyButton.disabled = false;
    }
    
    async function showStory() {
        if (!lastCalculation) return;
        
        storyButton.disabled = true;
        
        // Show the container inside the result screen
        storyContainer.classList.remove('hidden');
        storyText.textContent = ''; // Clear old text
        storyLoader.classList.remove('hidden'); // Show spinner
        
        try {
            const story = await generateStory(lastCalculation.num1, lastCalculation.op, lastCalculation.num2, lastCalculation.res);
            const words = story.split(' ');
            
            storyLoader.classList.add('hidden'); // Hide spinner
            
            // Typewriter effect inside the box
            for (const word of words) {
                storyText.textContent += word + ' ';
                await new Promise(r => setTimeout(r, 100)); // Typing speed
            }
        } catch (e) { 
            storyText.textContent = 'The numbers are shy today.'; 
            storyLoader.classList.add('hidden'); 
        }
        
        storyButton.disabled = false;
    }

    async function generateStory(num1, op, num2, res) {
      /* AI SIMULATION - Replace with real API key if you want */
      const stories = [
        (a,o,b,r) => `The numbers ${a} and ${b} met under a ${o} sign. Together, they became the legendary ${r}.`,
        (a,o,b,r) => `${a} challenged ${b} to a duel of ${o}. The dust settled, revealing ${r}.`,
        (a,o,b,r) => `Once, ${a} and ${b} combined their powers using ${o} to summon ${r}.`
      ];
      // Simulate API delay
      await new Promise(r => setTimeout(r, 1000));
      return stories[Math.floor(Math.random()*stories.length)](num1,op,num2,res);
    }
  </script>
</body>
</html>
